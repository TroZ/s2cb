<html>
<head>
<title>S2CB (Schematic To Command Block)</title>
</head>
<body>
<h1>S2CB (Schematic To Command Block) %PRGVER%</h1>
<br><br>

<p>This utility will load a .nbt saved structure file, a .schematic file, a .schem WorldEdit Schematic, or a .litematica schematic file and generate one or more command block commands that will re-create the structure in Minecraft.
This is useful if you have 'ops' on a Minecraft server and want to import a structure, but you cannot download, edit and re-upload the world or upload the .nbt file to the server.
This also allow using saved structure files that are larger than the game normally supports, such as ones generated by MCEdit or other similar utilities (once those utilities support 1.13).
This can also be used on single player worlds if cheats are enabled, or cheats can be temporarily enabled by opening a single player world to LAN and enabling cheats.
Once 'cheats' are enabled, you can go into creative mode to place and edit command blocks by typing '/gamemode creative' in chat 
(changing the 'creative' to 'survival' will switch you back to survival mode), and you can get a command block by typing '/give @p command_block'.
</p>
<p>
Earlier versions of this utility (for Minecraft Java version 1.12 or earlier) supported .schematic files used by MCEdit and similar utilities.
Those files are still supported, but due to the large changes in how Minecraft works (no more block ids or 4-bit block data, instead using block names and block state),
.shematic files may not completely convert correctly, and take more time to process as all the block id and block data has to be converted to the correct block names and block states.
</p>
 
<br><br>
<h3>Limitations</h3>
<ul>
<li>This utility is currently BETA quality, features are still being added and refined, and not all block combinations and structures have been tested. 
	However even if it doesn't work 100%, it should still get most of the blocks in the correct places.
	</li>
<li>This utility is only designed for Minecraft Java Edition %VER% and higher.   
	.Schematic files are currently only tested back to Minecraft 1.8, older schematics may work but may have more errors or missing blocks the older the version of Minecraft it is from.
	.nbt structure files are supported, but only ones from 1.13 or 1.14, as there were many block name changes before 1.13.
	</li>
<li>Litematica and World Edit Schematic file import has not been extensively tested and may have errors or bugs. 
	In particular, litematica schematics only support one subregion, as I haven't come across any that have more than one subregion to test with. 
	</li>
<li>Item frames and paintings, while not technically blocks, will also be reproduced by this utility (assuming you saved the structure with entities), although they should be considered somewhat experimental. 
	If any exist, they will be added in the last command block, to make sure all the walls they are on already exist.
	</li>
<li>Mobs and other entities, can also be imported, but should also be considered experimental. 
	They are also done at the end once all walls have been added already. Mobs imported this way tend to glitch through walls a bit, especially if in a tightly packed farm.  
	</li> 
<li>Due to the way animals tied to fence posts with leads are stored, they are not properly re-created, and will likely result in a broken lead near the location of the animal.
	The animal will be spawned in though.
	</li>
<li>Minecart rails / tracks will be spawned in, however, if a track is next to more than 2 tracks (T-intersections, or two or more lines right next to each other), they may not have
	the correct previous orientation. Minecart tracks configure their orientation based upon the order they are placed in, and even though the are spawned with their previous orientation
	specified, they aren't necessarily placed in the order they originally were, so rail placed later in the process may cause those placed earlier to re-orient in a way differently to what was specified.<br>
	The 'complex rails' option had been added to enable a mode that better rebuilds the rail lines, but should be considered experimental and can still get the rails wrong in some circumstances.
	</li>

</ul>


<br><br>
<h3>Use</h3>
<p>
Launch S2CB.  If you have Java installed, this should just involve double clicking on the .jar file.  
The default settings should be fine initially.  
Click the 'Choose...' button and select the structure file that you want to open, after setting all the options and parameters.
</p>
<p>
Within a few seconds the output area at the bottom should have some information about the structure and a series of commands that will recreate it.
If you used the default settings, then to recreate the structure in Minecraft you would place the same number of command blocks down in your world as there are commands, in a line from west to east.
The north west corner of the build will be one block south and one block east of the west most command block.
Copy the commands into the blocks, with command 1 going into the west most block, command 2 in the block just east of block 1, command 3 in the block just east of command 2, etc. and the last command in the east most block.
Then just activate the command block in order, from 1 to N, waiting for the previous command to finish running before activating the next command. This should be just a few seconds, depending on lag.
Command blocks can be activated by powering them with redstone, the easiest way to do this is to place a redstone torch next to them, or a redstone block. 
You can also place a button or pressure plate on or next to the command blocks (hold shift (crouch) if placing on the command block, but don't place on top of the command block as blocks are spawned on top of the command block) and use them to activate the command block.
The first command block will generate a red glazed terracotta block, a redstone block, and an activator rail on top of it.  These will be removed by the last command block. 
A few stray sand block items will be created as a side effect when multiple command blocks are needed.
</p>
<p>
You can manually highlight and copy (CTRL-C) the commands for pasting into the command blocks in Minecraft. 
However, you may find it easier to just click the 'Copy Command' button at the bottom right of the window.
After choosing a structure, this will show 'Copy Command 1', and clicking it will automatically place the command for the first command block into your clipboard, and ready the button for copying the second command (changing the label to 'Copy Command 2').
Once the final command has been copied, the button will disable itself.
You can use the 'Reset' button at any time to reset the Copy Command button back to copying the first command. 
</p>
<p>
If the new command offset is 'East No Space' (the default), before the the list on commands, will be a single command that will place all the command blocks needed for recreating the structure (they will be empty, you will still need to fill them with the correct commands), and it will create a flying machine to activate the command blocks that you can start after you have filled the command blocks with the correct commands.
If your structure only needs a few commands, this isn't too useful, however, if your structure takes many command block, this saves you from placing all the command blocks and from activating them correctly.
It is recommended that you place a command block facing upwards (with the circle side on top, this is so it is obvious that the block gets modified and faces north when the command is run) and put the one generation command into this block and activate it. 
Once activated, it will replace itself and place a row of command block equal to the amount needed to re-create your structure.
The command blocks will be all facing north, except every 5th one will be facing up, while every 25th will be facing south.
This is to make it easier to keep track of where you are when filling the command blocks with the commands to generate the structure.
Once the command blocks are filled with commands, activate the flying machine by placing a block on the face of the observer block one the back side of the flying machine (the side farthest from the command blocks).
The machine will stop at the end after hitting the furnace that was placed.
Be careful destroying the flying machine, as to not activate it again; it is recommended to first destroy the redstone block, followed by the two observer blocks, then the other blocks in any order. 
</p>


<br><br>


<h3>Example</h3>

<img src="guide.png"><br>
Top view of command blocks and build area.
<br><br>


<br><br>


<h3>Settings</h3>

<br>
<h4>Output</h4>
<p>
This utility was initially designed to output commands meant to be put in command blocks, so that there was no need to access the world save file to recreated the structure. 
While this does work, this somewhat limits the size of structures that can be imported this way.
Once structures reach a certain size, the number of command blocks needed to recreate them becomes very large. 
Filling 50 or 100 command blocks with the proper command is possible, but as the number of command blocks increase, the chance of making an error and needing to move or re-copy commands increases.
<br>
If you happen to have access to the world save, for example, in a single player world, or you have access to the server files of a multiplayer world, I have added an option to generate a Minecraft Data Pack that can be used to spawn the structure with one command block, no matter the structure size.
To use this, change the output type to 'Data Pack' from 'Command Block' before generating the commands.
This will prompt you to save the data pack file at the end of conversion.
You can then copy this file into the 'datapacks' directory of the Minecraft world you want to import the structure into.
In the world, you would place one command block at the north west corner of the area you want the structure build, and put in to it the command 
'function s2cb.<structure_name>.spawn'
Then power the command block from the north or west to spawn in the structure.
<br>
This actually may require multiple functions to be called (as functions have a limit of about 65000 commands each), but each function should automatically execute the next function if needed.
(It does this by deleting the command block and any blocks directly to the north or west, then replaces the command block with a command block to run the next function, and then powers it).
Setting output to 'Data Pack' will disable a few options, such as New Command Offset, as the don't apply to re-creating a structure with a data pack.  
</p>

<br>
<h4>New Command Offset</h4>
<p>
If more than one command is needed for the structure, this controls the placement of the additional command blocks relative to the previous one.
The default setting is 'East No Space', which means that the command blocks are lined from West to East, with the start in the West, with no space between the command blocks.
Other options include: 'East One Space', which has the command blocks lined from West to East, with one space between the command blocks (one space allows easier redstone wiring without needing to be careful to not activate adjacent command blocks).
'West No Space', and 'West One Space' have the command block go from East to West, with the first command block being the East most and the last command block being the West most.
The build is still made one block South and one block East of the first command block.
'North No Space' and 'North One Space' have the command block lined up from South to North, with the first command block in the South, and the last command block in the North.
Again, the build is still made one block South and one block East of the first command block.
'South No Space' and 'South One Space' have the command block lined up from North to South, with the first command block in the North, and the last command block in the South.
'Same Cmd Block' requires that all the commands are run from the same location, either editing the command block to change the command, or by breaking and replacing the command block after each command is run.<br>
Finally, 'Minecart Command Blocks' can be used of you want of have one or more minecart command blocks with the commands run over a single activator rail. 
This has a few minor differences compared to all the other settings. 
Because we cannot use the top of the first command block as work space, the work space is one block south and one block east of the activator rail.
This causes the whole build to be spawned one block further east and one block further south compared the other setting, however, since it also isn't on top of the command block, the build is also one block lower than it would be with other settings.  
</p>

<br>
<h4>Base</h4>
<p>
The structures are recreated using 'setblock' and 'fill' commands and 'summon' commands for entities (with some 'clone' commands possible if that option is enabled).
As such, unlike my original version of this utility, it doesn't need a flat base to build on.
However, certain builds may benefit from a flat base (ones with sand or gravel floors), and so this option will create a base of the specified material one block below the structure. 
</p>


<br>
<h4>Build Offset</h4>
<p>
Normally the structure is constructed so that it's northwest corner is 1 block south and 1 block east of the first (or only) command block. 
Adjusting the build offset will move where that location is.
This can allow command blocks underground to build on the surface, or command blocks in the spawn area to build in a far off place (but the location must be loaded).
Currently limited to +-255 for each direction.
Be careful to not have the resulting build area overlap the command block(s) creating the build.
</p>

<br>
<h4>Additional Options:</h4>


<br>
<h5>Quiet</h5>
<p>
With Quiet checked, a command will be run at the start of the build preventing additional command block output from being displayed in the chat log.
</p>

<br>
<h5>Clear</h5>
<p>
With Clear checked, the build area will be filled with air, removing all blocks from the area, before the structure is re-created.  
</p>



<br>
<h5>No Dangerous Blocks</h5>
<p>
When No Dangerous Blocks is selected, blocks of Lava, TNT or Fire won't be placed.  
This is useful for moving structures from worlds with fire tick turned off to worlds with fire tick turned on, to prevent them from burning themselves down,
or to make sure that TNT isn't accidentally set off as the structure is re-created.  
These blocks can then be manually placed if wanted.
</p>


<br>
<h5>No Monsters</h5>
<p>
With No Monsters checked, no hostile mobs / creatures will be spawned while re-creating the structure, although passive mobs will still be spawned.  
</p>

<br>
<h5>No Mobs</h5>
<p>
With No Mobs checked, no mobs / creatures will be spawned, passive or hostile.  Other entity types will still be created.  
</p>

<br>
<h5>No Projectiles</h5>
<p>
With No Projectiles checked, no projectiles will be recreated.  Projectiles are thrown eggs, shot arrows, thrown snowballs, fireballs, small fireballs, thrown ender pearls, eye of ender signals, thrown potions, thrown xp bottles, wither skull projectiles, and launched fireworks_rockets.  
</p>

<br>
<h5>Remove Barriers</h5>
<p>
With Remove Barriers checked, commands will be run at the end to remove barrier blocks. 
This is useful for bringing in slime block machine structures that have been 'jammed' using barrier blocks.  
</p>


<br>
<h5>Limit Cmd Distance</h5>
<p>
If this is checked, this will limit the length of the line of command blocks generated for a structure so that it is not longer than the structure is in the direction chosen for the command blocks to go in (the New Command Offset direction). 
This has a few limitations: 1. the line of command blocks will be at least 100 blocks long, even if the structure is narrower than that 2. this controls the number of command blocks, so if you choose one of the 'One Space' settings, it may be twice as long as the build is in that direction 3. the length of the command block line will always be a multiple of 25 for easy placement.
Each additional line of command blocks will be 3 blocks above and one block back from the previous line.
<br>
For example, if your structure is 160 blocks wide, but needs 321 command blocks to be generated, and you chose 'East No Space' (the default) offset, the first line will be as normal, with the first block starting 1 block north and 1 block west of the build area, and it will be 150 block long (the largest multiple of 25 less than 160).
The second line of command blocks will be 3 blocks above the initial command block (2 air blocks between them), and one block further away from the build area, perpendicular to the command block line direction; in this case, one block to the north.
(This offset is so blocks can fall on the initial command block.)
This second line is also 150 command blocks long, blocks 151 to 300.
The final line of command blocks is another 3 blocks up and one block further away form the build area, and this time is only 21 command blocks long, as that is the number of commands that remain.  
</p>


<br>
<h5>Ignore Wire Power</h5>
<p>
With Ignore Wire Power checked, redstone wires will be created without specifying their previous power level, relying on the game to recalculate the correct power level.
This results in smaller commands, as fill commands can be used to place most redstone wires, instead of using setBlock to individually place each piece of redstone wire with it's power level specified. 
Unchecked, each piece of redstone wire is placed individually with it's power level specified, which might be needed for some really complex redstone creations.  
</p>


<br>
<h5>Complex Rails</h5>
<p>
If checked, will more carefully place rails, one at a time, following the rail line directions, compared to just placing them along with other blocks, west to east, north to south, bottom to top.
</p><p>
Rails are a bit of a strange 'block' in Minecraft, one of a few whose shape / direction is affected by blocks placed around it, after it has been placed.  
Because of this, the order that the rails are placed in affect the final layout of the track - especially when you have multiple rail lines running along side each other or crossing in complex ways.
</p><p>
When unchecked (the default), the rails are placed along with other blocks, west to east, north to south, bottom to top.  This is fine if you only have one or a few rail lines, that are always at least a block apart and have no or just a few 'T' junctions. 
In that case, the only issue will possibly the 'T' junctions, possibly needing the curve to have it's direction changed in order to be correct. 
</p><p>
If you have rail lines that run right next to each other without space between them, or have many 'T' junctions or places where 4 rails converge on one curve, then you will want to enable this option to ensure as many rails are placed correctly as possible.
With the option checked, rails are placed one at a time, following along the rail path to ensure that they are connecting to their proper neighbors, starting from 'safe' locations (places where a rail is only surrounded by other rails that it connects to and that connect to it).
This option makes the commands larger, but should greatly reduce the potential errors in rail placement.  
The only issues that should remain when this is checked is circumstances that required rails to be placed to correct the direction of other rails to be placed, and then the 'correction rails' were deleted.
For example, a series of rail lines, without spaces between them ending all in a row would still turn into connected curve pairs even with 'Complex Rails' checked, but where they ran along side each other would be correct, which may not be the case with it unchecked, depending on the direction they were traveling. 
</p>


<br>
<h5>Min Water</h5>
<p>
With Min Water checked, only water source blocks are added, leading to smaller commands. 
Unchecked, all water blocks, source and flowing, are added.
Normally, just adding the water source block back should be enough to recreate a structure, letting the natural flow recreate any flowing water areas.
However, you may need to manually update the water to get it to flow (for some reason, water placed with setBlock doesn't check if it can flow when it is placed).
However, if your build used certain methods to shape the water flow, such as specifically building holes to force the flow in one direction, and then later filling them in, 
then you may need to uncheck this option to have the flowing water put back exactly like it was.   
</p>


<br>
<h5>Min Entities</h5>
<p>
With Min Entities checked, entities will be imported with only the essential properties needed to create them. 
Unchecked, all the properties of the entity saved in the structure will be reproduced.  
</p>


<br>
<h5>Hollow Out</h5>
<p>
With Hollow Out checked, blocks that are surrounded completely by non-transparent block are removed from the build. 
This should make most structures need less commands to reproduce, and should look identical.
However, it is possible that for certain structures, this will actually cause it to need more commands (because areas that could be done with a single large fill now will need several fill or set block commands),
or it could break certain mechanisms (for example, removing blocks that are supposed to be pushed by a piston).
Use with caution.
</p>

<br>
<h5>Check Clones</h5>
<p>
With Check Clones checked, the structure is scanned for duplicate area of the structure. 
These duplicate area are then reproduced by cloning the original area, instead of using setblock and fill commands to recreate them.
This is useful for reproducing castle walls or patterened floors or other sub-structures with regular repeating blocks. 
Minimum cloned area are 3x3x3 and must contain at least two block types, and areas up to 16x16x16 will be cloned.
<br>
This process is CPU and memory intensive. 
This can take a few minutes for a 256x256x256 structure.
You may need 4 GB of ram accessible to Java or more for large structures. 
</p>


<br>
<h5>Imperfect Fills</h5>
<p>
Normally, fill are done so that every block placed is correct, limiting fills to consecutive blocks of the same type.
However, sometimes thre are large areas of a single type of block, with just a few other types of blocks sprinkled in (for example, underground of normal terrain is mostly stone with a few other block types mixed in).
If this option is turned on, this utility will search for areas like this that can be done as a big fill, which later has some blocks replaced.
<b>This search can take a lot of time</b>, about 10 minutes for a 256x256x256 structure.
<br>
This can result in some areas being filled in that are later replaced with air again (when typically air 'blocks' are never placed except at the start when you have 'clear' selected).
This may result in more commands needed in certain cases, but the search for fills is tuned to try to avoid this (with fill only being done if more than 10 blocks more than then number of air blocks that will need to be replaced are placed by the fill).
Due to how the search works, it will get a somewhat faster as it goes along (as the search space is reduced by areas previously filled in).
<br>
This is only really useful for large structures. 
In testing, it reduces the number of command blocks needed by about 10% on some structures, but may not help at all (or actually take more command blocks) depending on the specific structure.
Will help further reduce the number of commands needed for a large structure that has already been 'hollowed out'.
</p>


<br>
<h5>Server Safe</h5>
<p>
This utility was originally tested in single player and Minecraft was found to support command lengths up to about 32500 characters. 
The utility currently tries to keep command lengths to to about 32000 characters (it stops adding more commands to the current command block at the point, adding one additional command to remove the minecarts this command added).
However, testing on a multiplayer server, I found that when I attempted to insert a command of that length into a command block, I was often kicked from the server, although upon rejoining, it was found that the full text of the command was in the command block.
I found that if I limited the command block length to 30000 characters, this no longer happened.
I'm not sure if this happens for all servers, or if it is because of particular settings on the server I normally play on.
<br>
That is what the Server Safe option does, it limits the command block length to 30000 characters instead of 32000 characters.
This will on average require about 7% more command blocks to generate a structure compared to unchecked, but should prevent you from getting kicked from multiplayer servers.
</p>


<br>
<h5>Schematic Banner Conversion</h5>
<p>
Most blocks that can be colored use the same 16 numbers to represent to colors, using the same number to represent the same color for each block type.
This is typically 0 for white, 1 for orange, 2 for magenta, 3 for light blue, etc. , 14 for red, and 15 for black.
This goes for wool, glass, stained clay, glazed terracotta, beds, carpets, etc. 
Except that for some reason, banners and the patterns on banners don't follow this same scheme.
The base banner color and color of patterns seem to have everything reversed (at least for banners from Minecraft 1.12).  
This also seems to be true for a few schematics I've tried for 1.8.9. 
However there are other schematics that even with the correction to reverse the number order, don't seem to have the correct color.
<br>
This setting allows you to apply the banner color correction to both the base color and pattern colors, or only one of them, or not to apply it at all.
This only applies to schematic files, that store banner colors as numbers.
The default it to apply the correction to both the base color and the pattern colors, as this seems to be correct for most schematics. 
</p>



<br><br>

<h3>Credits</h3>
<p>
Code for this utility was written by Brian Risinger  - <a href="https://www.youtube.com/user/troz100">TroZ</a> in Minecraft.<br>
Inspiration came from several places, but mainly from <a href="https://www.youtube.com/channel/UC3JIYyIY7xXYGMwRDb6pVYw">MrGarretto</a> whose similar 
<a href="http://mrgarretto.com/filter/structurecmd">Structure to Command MCEdit filter</a> caused me to abandon my falling sand approach (where every block (including additional command blocks) was spawned in as a falling sand block) and instead use
this current stacked Command Block Minecart approach (which was possible once two passenger boats were added to the game) to running multiple commands.<br>
This code uses the <a href="https://github.com/Querz/NBT">QUERZ NBT LIBRARY</a> to read nbt files.<br>
This code uses code from the <a href="https://github.com/maruohon/litematica">Litematica Mod</a> in order to properly litematica files.<br>
This code uses <a href="https://github.com/google/guava/wiki/Release18">GUAVA 18 Google Core Libraries for Java</a>.<br>
This code uses <a href="https://commons.apache.org/proper/commons-lang/">Apache Commons Lang Library</a>.<br>


<br><br>
This was mostly coded between 10pm and 2am, so if you find any issues, that is probably the reason.


</body>
</html>